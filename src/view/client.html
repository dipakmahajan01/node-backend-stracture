<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Send Notification</title>
  </head>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js"
    integrity="sha512-8BHxHDLsOHx+flIrQ0DrZcea7MkHqRU5GbTHmbdzMRnAaoCIkZ97PqZcXJkKZckMMhqfoeaJE+DNUVuyoQsO3Q=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <body>
    <h1>Send Notification</h1>
    <form id="notificationForm">
      <label for="message">Message:</label>
      <input type="text" id="message" name="message" required />
      <br /><br />
      <label for="timestamp">Timestamp:</label>
      <input type="datetime-local" id="timestamp" name="timestamp" required />
      <br /><br />
      <button type="submit">Send Notification</button>
    </form>

    <script>
      const socket = io('http://localhost:8081/v1/notification', {
        transportOptions: {
          polling: {
            extraHeaders: {
              authorization:
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiMSIsImlhdCI6MTczNTQ0NjU0OCwiZXhwIjoxNzM1NTMyOTQ4fQ.-1eEIHlQD_YGcKgsFMRtOasStL7mtAkdYsj6kgPg9hw',
            },
          },
        },
      });

      if (socket) {
        socket.emit('join-room');
      }
      socket.on('send-message', (data) => {
        console.log('Data', data);
        const container = document.getElementById('notificationForm');
        const newElement = document.createElement('p');
        newElement.textContent = data.data.message;
        container.appendChild(newElement);
      });

      document.getElementById('notificationForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        // Collect input data
        const message = document.getElementById('message').value;
        const timestamp = document.getElementById('timestamp').value;

        // Construct the data object
        const data = {
          user_id: '1', // Replace with actual user ID
          event_type: 'new_message', // Replace with your event type
          data: {
            message: message,
            timestamp: timestamp,
          },
        };

        try {
          // Send POST request to your API
          const response = await fetch('http://localhost:8081/api/notification/send-message', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          });

          // Handle API response
          const result = await response.json();
          if (response.ok) {
            alert('Notification sent successfully!');
          } else {
            alert('Error: ' + result.message);
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Failed to send notification.');
        }
      });
    </script>
  </body>
</html>
